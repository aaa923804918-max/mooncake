<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>æˆ‘çš„æœˆé¥¼ - æ˜¾ç¤ºå½’å±å§“å</title>
<style>
  :root{--bg:#0b1320;--box:#b14b2b;--accent:#ffd166;}
  html,body{height:100%;margin:0;font-family:"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",sans-serif;background:linear-gradient(180deg,#0b1320 0%,#192a3a 60%);color:#111;}
  .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:32px;box-sizing:border-box;}
  .stage{position:relative;width:360px;height:360px;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:18px;}
  .box{width:220px;height:220px;border-radius:14px;background:linear-gradient(180deg,var(--box),#7f2f1f);box-shadow:0 18px 40px rgba(0,0,0,.45), inset 0 6px 20px rgba(255,255,255,.03);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .35s ease;position:relative;overflow:visible;}
  .box:hover{transform:translateY(-6px) scale(1.02);}
  .box-label{position:absolute;bottom:16px;color:var(--accent);font-weight:700;font-size:18px;text-shadow:0 2px 6px rgba(0,0,0,.4)}
  .center{display:flex;align-items:center;justify-content:center;flex-direction:column;gap:8px;position:relative}
  .center-icon{font-size:42px;color:#ffe6c7;line-height:1}
  .mc-image{width:140px;height:140px;border-radius:18px;object-fit:cover;display:none;box-shadow:0 12px 30px rgba(0,0,0,.45);position:relative;background:#fff}
  .msg{color:#fff;background:rgba(255,255,255,.06);padding:8px 12px;border-radius:999px;font-size:13px}
  .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,.55);visibility:hidden;opacity:0;transition:opacity .2s, visibility .2s;}
  .modal.open{visibility:visible;opacity:1}
  .dialog{background:linear-gradient(180deg,#fff #fff);padding:18px;border-radius:10px;min-width:300px;box-shadow:0 20px 60px rgba(0,0,0,.45);display:flex;flex-direction:column;gap:10px}
  label{font-size:13px;color:#222}
  input[type="text"]{padding:10px 12px;border-radius:8px;border:1px solid #ddd;font-size:15px;outline:none}
  .actions{display:flex;gap:8px;justify-content:flex-end}
  button{padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
  .btn-cancel{background:#eee;color:#333}
  .btn-ok{background:var(--box);color:#fff}
  @media (max-width:420px){.stage{width:92vw;height:92vw}.box{width:64vw;height:64vw}.mc-image{width:56vw;height:56vw}}
</style>
</head>
<body>
<div class="wrap">
  <div class="stage" id="stage">
    <div class="box" id="box" title="ç‚¹å‡»æ‰“å¼€æœˆé¥¼ç›’" role="button" tabindex="0" aria-pressed="false">
      <div class="center">
        <div class="center-icon" id="centerIcon">ğŸŸ </div>
        <img id="mcImage" class="mc-image" alt="æœˆé¥¼å›¾ç‰‡">
      </div>
      <div class="box-label">ä¸­ç§‹å¿«ä¹</div>
    </div>

    <div class="msg" id="hint">ç‚¹å‡»ç›’å­è·å¾—å±äºä½ çš„æœˆé¥¼</div>
  </div>
</div>

<!-- å¼¹çª—è¾“å…¥ï¼ˆä»ä¿ç•™ç”¨äºè§¦å‘ï¼‰ -->
<div class="modal" id="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="dialog" role="document">
    <label for="nameInput">è¯·è¾“å…¥ä½ çš„å§“åï¼ˆå¯ç•™ç©ºï¼‰</label>
    <input id="nameInput" type="text" placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰" maxlength="20" />
    <div style="font-size:12px;color:#666">ç¡®è®¤åé¡µé¢å°†æ˜¾ç¤ºæœˆé¥¼å›¾ç‰‡ï¼Œæç¤ºä¼šæ˜¾ç¤ºå½’å±å¥å­ã€‚</div>
    <div class="actions">
      <button class="btn-cancel" id="cancelBtn">å–æ¶ˆ</button>
      <button class="btn-ok" id="okBtn">ç¡®è®¤</button>
    </div>
  </div>
</div>

<script>
  const box = document.getElementById('box');
  const modal = document.getElementById('modal');
  const nameInput = document.getElementById('nameInput');
  const okBtn = document.getElementById('okBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const hint = document.getElementById('hint');
  const centerIcon = document.getElementById('centerIcon');
  const mcImage = document.getElementById('mcImage');
  const stage = document.getElementById('stage');

  // æœ¬åœ°å›¾ç‰‡æ–‡ä»¶åï¼ˆå¦‚æœå·²ä¿å­˜ä¸º mooncake1.pngï¼‰
  const mooncakeImageFile = './mooncake1.png';

  // ç‚¹å‡»ç›’å­å¼¹å‡ºè¾“å…¥æ¡†ï¼ˆç‚¹å‡»å·²é¢†å–çš„å›¾ç‰‡ä¸å¼¹çª—ï¼‰
  box.addEventListener('click', () => {
    const isClaimed = mcImage.style.display === 'block';
    if (isClaimed) return;
    nameInput.value = '';
    modal.classList.add('open');
    modal.setAttribute('aria-hidden','false');
    nameInput.focus();
  });

  // é”®ç›˜æ— éšœç¢æ”¯æŒ
  box.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); box.click(); }
  });

  cancelBtn.addEventListener('click', closeModal);
  function closeModal(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); }

  nameInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') okBtn.click();
    if (e.key === 'Escape') cancelBtn.click();
  });

  okBtn.addEventListener('click', () => {
    const raw = (nameInput.value || '').trim();
    const name = raw === '' ? 'ä½ ' : raw; // é»˜è®¤ç§°å‘¼â€œä½ â€
    closeModal();
    showImageWithName(name);
  });

  function showImageWithName(name){
    mcImage.src = mooncakeImageFile;
    mcImage.style.display = 'block';
    centerIcon.style.display = 'none';
    // æ˜¾ç¤ºå½’å±æç¤º
    const safe = name.length > 12 ? name.slice(0,12) + 'â€¦' : name;
    hint.textContent = `è¿™æ˜¯å±äº ${safe} çš„æœˆé¥¼`;
    box.setAttribute('aria-pressed','true');
  }

  // ç‚¹å‡»èˆå°ç©ºç™½æ¢å¤åˆå§‹ç•Œé¢
  stage.addEventListener('click', (e) => {
    if (e.target.closest('.box') || modal.classList.contains('open')) return;
    resetToInitial();
  });

  function resetToInitial(){
    mcImage.style.display = 'none';
    mcImage.src = '';
    centerIcon.style.display = 'block';
    hint.textContent = 'ç‚¹å‡»ç›’å­è·å¾—å±äºä½ çš„æœˆé¥¼';
    box.setAttribute('aria-pressed','false');
  }

  resetToInitial();
</script>
</body>
</html>
